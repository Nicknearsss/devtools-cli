#!/usr/bin/env bash
# ==================================
# DevTools CLI Dispatcher
# ==================================

set -euo pipefail
IFS=$'\n\t'

DEVTOOLS_BANNER='
  ____   _____ __     __ _______              _     
 |  _ \ | ____|\ \   / /|__   __| ___   ___  | | ___ 
 | | | ||  _|   \ \ / /    | |   / _ \ / _ \ | |/ __|
 | |_| || |___   \ V /     | |  | (_) | (_) || |\__ \
 |____/ |_____|   \_/      |_|   \___/ \___/ |_||___/

                     D E V T O O L S   C L I
'

# Resolve base directory
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do
  DIR="$(cd -P "$(dirname "$SOURCE")" >/dev/null 2>&1 && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
BASEDIR="$(cd -P "$(dirname "$SOURCE")/.." >/dev/null 2>&1 && pwd)"
COMMANDS_DIR="$BASEDIR/Terminal-Commands"

# Help text
show_help() {
cat <<'EOF'
DevTools CLI (@kingzyphor/devtools-cli)

Usage:
  devtools <command> [args...]
  dt <command> [args...]

Commands:
  git-autopush [options] [paths...]     Automated git add/commit/push helper
  smart-git-clone <repo-url>            Clone repo, auto-install deps, run dev server, fetch GitHub info
  code-check [path]                     Run code quality and warning/error checks
  env-creator                            Create a .env file interactively
  debug-suite <subcmd> [args...]        Debugging utilities (logs|port|deps|ps|env)
  sys-info                               System & environment diagnostics
  repo-cleaner [--apply|--dry-run]      Organize/clean repo files
  branch-sync <branch> [options]        Sync local branch with remote
  error-trace <pid|run> [args...]       Gather traces for PID or run command under trace
  install                                Run packaged installer (install.sh)
  help                                   Show this help

Examples:
  devtools smart-git-clone https://github.com/user/repo.git
  devtools code-check src/
  dt env-creator
EOF
}

# Main dispatch
if [ $# -eq 0 ]; then
  printf '%s\n' "$DEVTOOLS_BANNER"
  show_help
  exit 0
fi

cmd="$1"; shift

case "$cmd" in
  git-autopush) exec "$COMMANDS_DIR/git-autopush.sh" "$@" ;;
  smart-git-clone) exec "$COMMANDS_DIR/smart-git-clone.sh" "$@" ;;
  code-check) exec "$COMMANDS_DIR/code-check.sh" "$@" ;;
  env-creator) exec "$COMMANDS_DIR/env-creator.sh" "$@" ;;
  debug-suite) exec "$COMMANDS_DIR/debug-suite.sh" "$@" ;;
  sys-info) exec "$COMMANDS_DIR/sys-info.sh" "$@" ;;
  repo-cleaner) exec "$COMMANDS_DIR/repo-cleaner.sh" "$@" ;;
  branch-sync) exec "$COMMANDS_DIR/branch-sync.sh" "$@" ;;
  error-trace) exec "$COMMANDS_DIR/error-trace.sh" "$@" ;;
  install) exec "$BASEDIR/install.sh" "$@" ;;
  -h|--help|help) show_help ;;
  *)
    printf 'Unknown command: %s\n\n' "$cmd" >&2
    show_help
    exit 2
    ;;
esac
